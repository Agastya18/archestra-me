<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Javy WASM Sum Example</title>
</head>
<body>
  <h1>Sum Two Numbers (Javy WASM)</h1>
  <form id="sumForm">
    <input type="number" id="numA" required placeholder="First number">
    <input type="number" id="numB" required placeholder="Second number">
    <button type="submit">Sum</button>
  </form>
  <pre id="output"></pre>
  <script src="https://unpkg.com/buffer@6.0.3/index.js"></script>
  <script type="module">
    import { Buffer } from "https://unpkg.com/buffer@6.0.3/index.js";
    import { init, WASI } from "https://unpkg.com/@wasmer/wasi@1.2.2/dist/Library.esm.js";

    document.getElementById('sumForm').onsubmit = async (e) => {
      e.preventDefault();
      const a = Number(document.getElementById('numA').value);
      const b = Number(document.getElementById('numB').value);
      const inputJson = JSON.stringify({ a, b });
      const inputBytes = new TextEncoder().encode(inputJson);

      await init();

      // Set up WASI with our input as stdin
      const wasi = new WASI({
        args: [],
        env: {},
        stdin: inputBytes,
        stdout: true,
        stderr: true
      });

      const response = await fetch('my_node_code.wasm');
      const wasmBytes = await response.arrayBuffer();
      const { instance } = await WebAssembly.instantiate(wasmBytes, {
        ...wasi.getImports()
      });
      wasi.start(instance);
      const output = wasi.getStdoutString();
      try {
        const result = JSON.parse(output);
        document.getElementById('output').textContent = `Result: ${result.result}`;
      } catch (err) {
        document.getElementById('output').textContent = 'Error parsing WASM output: ' + output;
      }
    };
  </script>
</body>
</html>
